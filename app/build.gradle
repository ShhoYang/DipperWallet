def keystorePropertiesFile = rootProject.file("key.properties")
def keystoreProperties = new Properties()
keystorePropertiesFile.withReader('UTF-8') { reader ->
    keystoreProperties.load(reader)
}

apply plugin: 'com.android.application'
apply plugin: 'kotlin-android'
apply plugin: 'kotlin-kapt'

android {
    compileSdkVersion versions.compileSdk
    buildToolsVersion versions.buildTools
    defaultConfig {
        applicationId 'com.highstreet.wallet'
        minSdkVersion versions.minSdk
        targetSdkVersion versions.targetSdk
        versionCode 16
        versionName "1.1.3"

        multiDexEnabled true
    }

    signingConfigs {
        release {
            storeFile file(keystoreProperties['storeFile'])
            storePassword keystoreProperties['storePassword']
            keyAlias keystoreProperties['keyAlias']
            keyPassword keystoreProperties['keyPassword']
            v1SigningEnabled true
            v2SigningEnabled true
        }
    }

    buildTypes {
        debug {
            minifyEnabled false
            signingConfig signingConfigs.release
            proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'
        }
        release {
            minifyEnabled false
            signingConfig signingConfigs.release
            proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'
        }
    }

//    productFlavors {
//        product {
//            applicationId 'com.highstreet.wallet'
//            manifestPlaceholders = [
//                    APP_ICON: '@mipmap/ic_launcher'
//            ]
//            buildConfigField 'String', 'BASE_URL', '"https://rpc.dippernetwork.com/"'
//            buildConfigField 'Boolean', 'testnet', 'false'
//        }
//        dev {
//            applicationId = 'com.highstreet.wallet.test'
//            manifestPlaceholders = [
//                    APP_ICON: '@mipmap/ic_launcher_2'
//            ]
//            buildConfigField 'String', 'BASE_URL', '"https://rpc.testnet.dippernetwork.com/"'
//            buildConfigField 'Boolean', 'testnet', 'true'
//        }
//    }

    applicationVariants.all { variant ->
        variant.outputs.all { output ->
            outputFileName = "Wallet-${defaultConfig.versionName}.apk"
        }
    }

    packagingOptions {
        exclude 'lib/x86_64/darwin/libscrypt.dylib'
        exclude 'lib/x86_64/freebsd/libscrypt.so'
        exclude 'lib/x86_64/linux/libscrypt.so'
    }

    compileOptions {
        sourceCompatibility JavaVersion.VERSION_1_8
        targetCompatibility JavaVersion.VERSION_1_8
    }

    lintOptions {
        checkReleaseBuilds false
        abortOnError false
    }

    buildFeatures {
        viewBinding true
    }

    kotlinOptions {
        jvmTarget = '1.8'
    }

    packagingOptions {
        exclude 'META-INF/spring.schemase'
        exclude 'META-INF/spring.schemas'
        exclude 'META-INF/spring.tooling'
        exclude 'META-INF/spring.handlers'
        exclude 'META-INF/license.txt'
        exclude 'META-INF/notice.txt'
    }
}

kapt {
    arguments {
        arg("DAGGER_VIEW_BINDING_FEATURE", "databinding")
        arg("DAGGER_VIEW_MODEL_FEATURE", "vm")
        arg("DAGGER_ADAPTER_FEATURE", "adapter")
    }
}

dependencies {
    implementation fileTree(include: ['*.jar'], dir: 'libs')
    implementation "com.github.haoshiy.android:library:$versions.haolibrary"
    implementation 'org.bitcoinj:bitcoinj-core:0.15.2'
    implementation 'com.king.zxing:zxing-lite:1.1.9'
    implementation 'cat.ereza:customactivityoncrash:2.2.0'
    implementation 'net.zetetic:android-database-sqlcipher:3.5.9@aar'
    implementation 'com.github.tbruyelle:rxpermissions:0.10.2'
//    implementation 'org.web3j:core:4.8.4'
    implementation 'org.web3j:core:4.6.0-android'
    implementation("org.ethereum:ethereumj-core:1.12.+") {
        exclude group: "org.iq80.leveldb"
    }

//    implementation "com.fasterxml.jackson.module:jackson-module-kotlin:2.11.0"
//    implementation "org.apache.commons:commons-collections4:4.0"
//    implementation "org.apache.commons:commons-lang3:3.4"

    kapt "com.github.haoshiy.android:library-compiler:$versions.haolibrary"
    kapt "androidx.lifecycle:lifecycle-compiler:2.2.0"
    kapt "androidx.room:room-compiler:2.2.5"
    kapt "com.github.bumptech.glide:compiler:4.12.0"
}